# エフィーの3rdトレーニング Lua

[English](https://github.com/effie3rd/3rd_training_lua/blob/main/README.md)  
[インストール](#インストール)

---

### 主な機能
- ブロッキングシステムを完全に再設計  
- フレームデータモデルを一から作り直し  
- 特殊なトレーニングモードを追加  
- 新しいオプションや表示機能を多数追加  
- UIのデザインを刷新  

---

### 予測機能
- 全ての動作でサブピクセル位置と速度ベースの移動を使用  
- アンブロッカブル、天狗石などの攻撃をパリィ可能  
- 起き上がり予測 ― セーブステート読み込み後にリバーサルを行うダミーを再現  

---

### メニューの再設計
- 透明背景と読みやすいテキスト  
- ダミーメニューを再編成  
  - 技名とボタンでカウンター攻撃を選択可能  
  - 必殺技の入力シーケンスを表示  
  - オプションセレクトをカウンター攻撃として選択可能（ガードジャンプに追加設定不要）  
    - ガードジャンプ、パリィ付きガードジャンプ、しゃがみ投げ抜け、ブロック＆遅らせ投げ抜け、前下、前下前、前前  
- ボタンおよびメニューテーマの追加  
- 日本語表示対応  

---

### 新しいオプション
- 初段ガード後にブロック  
- 下パリィを優先  
- n回目の攻撃で赤パリィ  
- n回目の攻撃後に反撃  
- 反撃ディレイ  
- ボタン連打入力 ― スタンや掴みからの脱出  
- オートパリィ、ユニバーサルキャンセル、無限ジャグル、無限飛び道具  

---

### 新しい表示機能
- **Attack Bars**: 直前の2つの攻撃のダメージ／スタンを比較するコンパクト表示  
- **Attack Range**: 直近1～3回の攻撃の最大リーチを表示  
- **Blocking Direction**: ダミーが使用したブロック方向を表示。曖昧なクロスアップの検証に便利  
- **Red Parry Miss Indicator**: 赤パリィ失敗時に、何フレームずれていたか赤い数字で表示  
- **Stun Timer**: 残りスタン時間を表示  
- **Air Time**: 相手がジャグル不能になった時に青く表示（2フレーム遅延あり。正確な判定はゲージを参照）  
- **Parry/Charge**  
  - 外観を更新  
  - プレイヤー追従コードを調整  
  - パリィ表示をコンパクト化  
  - 360／720入力、電刃表示を追加  
- **フレーム有利表示をアニメーション化**  

---

### 特殊トレーニングモード
- ディフェンス  
- ジャンプイン  
- フットシーズ（差し合い）  
- アンブロッカブル  
- 玄人神（ゲンイジン）  

---

### その他
- **ロード時間短縮**：フレームデータをゲーム起動後に非同期で読み込み。ウィンドウ表示が約0.5秒高速化  
- ランダムキャラクター選択  
- ステージ強制選択  
- 体力／ゲージ／スタン回復処理を調整  
- リプレイ記録の不整合を修正（画面暗転が1フレーム遅れて同期ずれを起こす問題）  
- 攻撃データのスタン値が、攻撃中に相手が回復した分を反映するよう変更  
- セットアップ後の正確なフレーム有利計算（プレイヤー移動を考慮）  

---

### 技術的な変更点
- コードをリファクタリング  
- メモリアドレスを追加  
  - 速度、加速度、スタン状態、スタン値（小数）、グラフィックモード、360チャージ、空中タイマー、タイムドSA状態、電刃状態、天狗状態、技タイプ、被弾タイプ／強度、パリィ状態など  
- フレームデータ構造を更新  
  - **アニメーションレベル**：name, frames, hit_frames, idle_frames, loops, pushback, advantage, uses_velocity, air, infinite_loop, max_hits, cooldown, self_chain, exceptions, landing_height  
  - **フレームレベル**：hash, boxes, movement, velocity, acceleration, loop, next_anim, optional_anim, wakeup, bypass_freeze, projectile, ignore_motion  
- キャラクター選択：ボス選択を統一化。ボス選択禁止やキャラ固定のオプションを追加  
- デバッグメニューを更新  

---

### バグ修正
- ヒット／飛び道具の判定検出を修正  
- 多段攻撃・スーパーアーツのブロック対応  
- 同一技の連続（フレームパーフェクト入力）でブロックされない問題を修正  
- 角に追い込まれた相手へのジャンプ攻撃の裏当たり問題を修正  
- チャージ技・360系技のリバーサル再現性を改善  

---

### インストール
<table><tr><td>
ファイルを **`fbneo-training-mode`** ディレクトリに貼り付け、すべて上書きしてください。  
ファイトケイドのメニューから「Training」をクリックして起動します。
</td></tr></table>
